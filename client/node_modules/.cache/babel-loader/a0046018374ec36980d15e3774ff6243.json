{"ast":null,"code":"import _slicedToArray from \"/home/kevin/Documents/js_html_css/fitness_website/second_start/client/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\nvar _jsxFileName = \"/home/kevin/Documents/js_html_css/fitness_website/second_start/client/src/contexts/auth/authState.js\";\nimport React, { useReducer } from 'react';\nimport axios from 'axios';\nimport AuthContext from './authContext';\nimport AuthReducer from './authReducer';\nimport setAuthToken from '../../utils/setAuthToken';\nimport { REGISTER_SUCCESS, REGISTER_FAIL, USER_LOADED, AUTH_ERROR, LOGIN_SUCCESS, LOGIN_FAIL, LOGOUT, UPDATE_SUCCESS, UPDATE_FAIL, PASSWORD_SUCCESS, PASSWORD_FAIL, USER_DELETED_SUCCESS, USER_DELETED_FAIL, SET_AUTH_LOADING, CLEAR_AUTH_ERRORS } from '../types';\n\nconst AuthState = props => {\n  const initialState = {\n    token: localStorage.getItem('token'),\n    isAuthenticated: false,\n    user: null,\n    userError: null,\n    userLoading: false\n  };\n\n  const _useReducer = useReducer(AuthReducer, initialState),\n        _useReducer2 = _slicedToArray(_useReducer, 2),\n        state = _useReducer2[0],\n        dispatch = _useReducer2[1]; //used for requests sending data\n\n\n  const config = {\n    headers: {\n      'Content-Type': 'application/json'\n    }\n  }; //get user data\n\n  const getUser = async () => {\n    //console.log('getUser')\n    if (localStorage.token) {\n      setAuthToken(localStorage.token);\n    }\n\n    try {\n      setLoading();\n      const res = await axios.get('/api/auth');\n      dispatch({\n        type: USER_LOADED,\n        payload: res.data\n      });\n    } catch (err) {\n      dispatch({\n        type: AUTH_ERROR,\n        payload: err.response.data.msg\n      });\n    }\n  }; //log in user\n\n\n  const loginUser = async formData => {\n    //console.log('loginUser')\n    try {\n      setLoading();\n      const res = await axios.post('/api/auth', formData, config);\n      dispatch({\n        type: LOGIN_SUCCESS,\n        payload: res.data\n      });\n      getUser();\n    } catch (err) {\n      dispatch({\n        type: LOGIN_FAIL,\n        payload: err.response.data.msg\n      });\n    }\n  }; //register new user\n\n\n  const registerUser = async formData => {\n    //console.log('registerUser')\n    try {\n      setLoading();\n      const res = await axios.post('/api/users', formData, config);\n      dispatch({\n        type: REGISTER_SUCCESS,\n        payload: res.data\n      });\n      getUser();\n    } catch (err) {\n      dispatch({\n        type: REGISTER_FAIL,\n        payload: err.response.data.msg\n      });\n    }\n  }; //update user\n\n\n  const updateUser = async user => {\n    //console.log('updateUser')\n    try {\n      setLoading();\n      const res = await axios.patch(`/api/auth/${user._id}`, user, config);\n      dispatch({\n        type: UPDATE_SUCCESS,\n        payload: {\n          user: res.data.user,\n          msg: res.data.msg\n        }\n      });\n    } catch (err) {\n      dispatch({\n        type: UPDATE_FAIL,\n        payload: err.response.data.msg\n      });\n    }\n  }; //change user password\n\n\n  const changeUserPassword = async (formData, _id) => {\n    //console.log('changeUserPassword')\n    try {\n      setLoading();\n      const res = await axios.patch(`/api/auth/password/${_id}`, formData, config);\n      dispatch({\n        type: PASSWORD_SUCCESS,\n        payload: res.data.msg\n      });\n    } catch (err) {\n      dispatch({\n        type: PASSWORD_FAIL,\n        payload: err.response.data.msg\n      });\n    }\n  }; //delete user\n\n\n  const deleteUser = async (password, _id) => {\n    //console.log('deleteUser')\n    try {\n      setLoading();\n      const res = await axios.delete(`/api/auth/${_id}`, {\n        config,\n        data: {\n          password\n        }\n      });\n      dispatch({\n        type: USER_DELETED_SUCCESS,\n        payload: res.data.msg\n      });\n    } catch (err) {\n      dispatch({\n        type: USER_DELETED_FAIL,\n        payload: err.response.data.msg\n      });\n    }\n  }; //logout\n\n\n  const logoutUser = () => {\n    //console.log('logoutUser')\n    dispatch({\n      type: LOGOUT\n    });\n  }; //set loading\n\n\n  const setLoading = () => {\n    //console.log('setLoading')\n    dispatch({\n      type: SET_AUTH_LOADING\n    });\n  }; //clear errors\n\n\n  const clearUserErrors = () => {\n    //console.log('clearUserErrors')\n    dispatch({\n      type: CLEAR_AUTH_ERRORS\n    });\n  };\n\n  return React.createElement(AuthContext.Provider, {\n    value: {\n      token: state.token,\n      isAuthenticated: state.isAuthenticated,\n      user: state.user,\n      userError: state.userError,\n      userLoading: state.userLoading,\n      loginUser,\n      registerUser,\n      updateUser,\n      changeUserPassword,\n      deleteUser,\n      logoutUser,\n      clearUserErrors\n    },\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 143\n    },\n    __self: this\n  }, props.children);\n};\n\nexport default AuthState;","map":{"version":3,"sources":["/home/kevin/Documents/js_html_css/fitness_website/second_start/client/src/contexts/auth/authState.js"],"names":["React","useReducer","axios","AuthContext","AuthReducer","setAuthToken","REGISTER_SUCCESS","REGISTER_FAIL","USER_LOADED","AUTH_ERROR","LOGIN_SUCCESS","LOGIN_FAIL","LOGOUT","UPDATE_SUCCESS","UPDATE_FAIL","PASSWORD_SUCCESS","PASSWORD_FAIL","USER_DELETED_SUCCESS","USER_DELETED_FAIL","SET_AUTH_LOADING","CLEAR_AUTH_ERRORS","AuthState","props","initialState","token","localStorage","getItem","isAuthenticated","user","userError","userLoading","state","dispatch","config","headers","getUser","setLoading","res","get","type","payload","data","err","response","msg","loginUser","formData","post","registerUser","updateUser","patch","_id","changeUserPassword","deleteUser","password","delete","logoutUser","clearUserErrors","children"],"mappings":";;AAAA,OAAOA,KAAP,IAAgBC,UAAhB,QAAkC,OAAlC;AACA,OAAOC,KAAP,MAAkB,OAAlB;AACA,OAAOC,WAAP,MAAwB,eAAxB;AACA,OAAOC,WAAP,MAAwB,eAAxB;AACA,OAAOC,YAAP,MAAyB,0BAAzB;AACA,SACEC,gBADF,EAEEC,aAFF,EAGEC,WAHF,EAIEC,UAJF,EAKEC,aALF,EAMEC,UANF,EAOEC,MAPF,EAQEC,cARF,EASEC,WATF,EAUEC,gBAVF,EAWEC,aAXF,EAYEC,oBAZF,EAaEC,iBAbF,EAcEC,gBAdF,EAeEC,iBAfF,QAgBO,UAhBP;;AAkBA,MAAMC,SAAS,GAAGC,KAAK,IAAI;AACzB,QAAMC,YAAY,GAAG;AACnBC,IAAAA,KAAK,EAAEC,YAAY,CAACC,OAAb,CAAqB,OAArB,CADY;AAEnBC,IAAAA,eAAe,EAAE,KAFE;AAGnBC,IAAAA,IAAI,EAAE,IAHa;AAInBC,IAAAA,SAAS,EAAE,IAJQ;AAKnBC,IAAAA,WAAW,EAAE;AALM,GAArB;;AADyB,sBASC7B,UAAU,CAACG,WAAD,EAAcmB,YAAd,CATX;AAAA;AAAA,QASlBQ,KATkB;AAAA,QASXC,QATW,oBAWzB;;;AACA,QAAMC,MAAM,GAAG;AACbC,IAAAA,OAAO,EAAE;AACP,sBAAgB;AADT;AADI,GAAf,CAZyB,CAkBzB;;AACA,QAAMC,OAAO,GAAG,YAAY;AAC1B;AACA,QAAIV,YAAY,CAACD,KAAjB,EAAwB;AACtBnB,MAAAA,YAAY,CAACoB,YAAY,CAACD,KAAd,CAAZ;AACD;;AACD,QAAI;AACFY,MAAAA,UAAU;AACV,YAAMC,GAAG,GAAG,MAAMnC,KAAK,CAACoC,GAAN,CAAU,WAAV,CAAlB;AACAN,MAAAA,QAAQ,CAAC;AAAEO,QAAAA,IAAI,EAAE/B,WAAR;AAAqBgC,QAAAA,OAAO,EAAEH,GAAG,CAACI;AAAlC,OAAD,CAAR;AACD,KAJD,CAIE,OAAOC,GAAP,EAAY;AACZV,MAAAA,QAAQ,CAAC;AAAEO,QAAAA,IAAI,EAAE9B,UAAR;AAAoB+B,QAAAA,OAAO,EAAEE,GAAG,CAACC,QAAJ,CAAaF,IAAb,CAAkBG;AAA/C,OAAD,CAAR;AACD;AACF,GAZD,CAnByB,CAiCzB;;;AACA,QAAMC,SAAS,GAAG,MAAMC,QAAN,IAAkB;AAClC;AACA,QAAI;AACFV,MAAAA,UAAU;AACV,YAAMC,GAAG,GAAG,MAAMnC,KAAK,CAAC6C,IAAN,CAAW,WAAX,EAAwBD,QAAxB,EAAkCb,MAAlC,CAAlB;AACAD,MAAAA,QAAQ,CAAC;AAAEO,QAAAA,IAAI,EAAE7B,aAAR;AAAuB8B,QAAAA,OAAO,EAAEH,GAAG,CAACI;AAApC,OAAD,CAAR;AACAN,MAAAA,OAAO;AACR,KALD,CAKE,OAAOO,GAAP,EAAY;AACZV,MAAAA,QAAQ,CAAC;AAAEO,QAAAA,IAAI,EAAE5B,UAAR;AAAoB6B,QAAAA,OAAO,EAAEE,GAAG,CAACC,QAAJ,CAAaF,IAAb,CAAkBG;AAA/C,OAAD,CAAR;AACD;AACF,GAVD,CAlCyB,CA8CzB;;;AACA,QAAMI,YAAY,GAAG,MAAMF,QAAN,IAAkB;AACrC;AACA,QAAI;AACFV,MAAAA,UAAU;AACV,YAAMC,GAAG,GAAG,MAAMnC,KAAK,CAAC6C,IAAN,CAAW,YAAX,EAAyBD,QAAzB,EAAmCb,MAAnC,CAAlB;AACAD,MAAAA,QAAQ,CAAC;AAAEO,QAAAA,IAAI,EAAEjC,gBAAR;AAA0BkC,QAAAA,OAAO,EAAEH,GAAG,CAACI;AAAvC,OAAD,CAAR;AACAN,MAAAA,OAAO;AACR,KALD,CAKE,OAAOO,GAAP,EAAY;AACZV,MAAAA,QAAQ,CAAC;AAAEO,QAAAA,IAAI,EAAEhC,aAAR;AAAuBiC,QAAAA,OAAO,EAAEE,GAAG,CAACC,QAAJ,CAAaF,IAAb,CAAkBG;AAAlD,OAAD,CAAR;AACD;AACF,GAVD,CA/CyB,CA2DzB;;;AACA,QAAMK,UAAU,GAAG,MAAMrB,IAAN,IAAc;AAC/B;AACA,QAAI;AACFQ,MAAAA,UAAU;AACV,YAAMC,GAAG,GAAG,MAAMnC,KAAK,CAACgD,KAAN,CAAa,aAAYtB,IAAI,CAACuB,GAAI,EAAlC,EAAqCvB,IAArC,EAA2CK,MAA3C,CAAlB;AACAD,MAAAA,QAAQ,CAAC;AAAEO,QAAAA,IAAI,EAAE1B,cAAR;AAAwB2B,QAAAA,OAAO,EAAE;AAAEZ,UAAAA,IAAI,EAAES,GAAG,CAACI,IAAJ,CAASb,IAAjB;AAAuBgB,UAAAA,GAAG,EAAEP,GAAG,CAACI,IAAJ,CAASG;AAArC;AAAjC,OAAD,CAAR;AACD,KAJD,CAIE,OAAOF,GAAP,EAAY;AACZV,MAAAA,QAAQ,CAAC;AAAEO,QAAAA,IAAI,EAAEzB,WAAR;AAAqB0B,QAAAA,OAAO,EAAEE,GAAG,CAACC,QAAJ,CAAaF,IAAb,CAAkBG;AAAhD,OAAD,CAAR;AACD;AACF,GATD,CA5DyB,CAuEzB;;;AACA,QAAMQ,kBAAkB,GAAG,OAAON,QAAP,EAAiBK,GAAjB,KAAyB;AAClD;AACA,QAAI;AACFf,MAAAA,UAAU;AACV,YAAMC,GAAG,GAAG,MAAMnC,KAAK,CAACgD,KAAN,CAAa,sBAAqBC,GAAI,EAAtC,EAAyCL,QAAzC,EAAmDb,MAAnD,CAAlB;AACAD,MAAAA,QAAQ,CAAC;AAAEO,QAAAA,IAAI,EAAExB,gBAAR;AAA0ByB,QAAAA,OAAO,EAAEH,GAAG,CAACI,IAAJ,CAASG;AAA5C,OAAD,CAAR;AACD,KAJD,CAIE,OAAOF,GAAP,EAAY;AACZV,MAAAA,QAAQ,CAAC;AAAEO,QAAAA,IAAI,EAAEvB,aAAR;AAAuBwB,QAAAA,OAAO,EAAEE,GAAG,CAACC,QAAJ,CAAaF,IAAb,CAAkBG;AAAlD,OAAD,CAAR;AACD;AACF,GATD,CAxEyB,CAmFzB;;;AACA,QAAMS,UAAU,GAAG,OAAOC,QAAP,EAAiBH,GAAjB,KAAyB;AAC1C;AACA,QAAI;AACFf,MAAAA,UAAU;AACV,YAAMC,GAAG,GAAG,MAAMnC,KAAK,CAACqD,MAAN,CAAc,aAAYJ,GAAI,EAA9B,EAAiC;AACjDlB,QAAAA,MADiD;AAEjDQ,QAAAA,IAAI,EAAE;AACJa,UAAAA;AADI;AAF2C,OAAjC,CAAlB;AAMAtB,MAAAA,QAAQ,CAAC;AAAEO,QAAAA,IAAI,EAAEtB,oBAAR;AAA8BuB,QAAAA,OAAO,EAAEH,GAAG,CAACI,IAAJ,CAASG;AAAhD,OAAD,CAAR;AACD,KATD,CASE,OAAOF,GAAP,EAAY;AACZV,MAAAA,QAAQ,CAAC;AAAEO,QAAAA,IAAI,EAAErB,iBAAR;AAA2BsB,QAAAA,OAAO,EAAEE,GAAG,CAACC,QAAJ,CAAaF,IAAb,CAAkBG;AAAtD,OAAD,CAAR;AACD;AACF,GAdD,CApFyB,CAoGzB;;;AACA,QAAMY,UAAU,GAAG,MAAM;AACvB;AACAxB,IAAAA,QAAQ,CAAC;AAAEO,MAAAA,IAAI,EAAE3B;AAAR,KAAD,CAAR;AACD,GAHD,CArGyB,CA0GzB;;;AACA,QAAMwB,UAAU,GAAG,MAAM;AACvB;AACAJ,IAAAA,QAAQ,CAAC;AAAEO,MAAAA,IAAI,EAAEpB;AAAR,KAAD,CAAR;AACD,GAHD,CA3GyB,CAgHzB;;;AACA,QAAMsC,eAAe,GAAG,MAAM;AAC5B;AACAzB,IAAAA,QAAQ,CAAC;AAAEO,MAAAA,IAAI,EAAEnB;AAAR,KAAD,CAAR;AACD,GAHD;;AAKA,SACE,oBAAC,WAAD,CAAa,QAAb;AACA,IAAA,KAAK,EAAE;AACLI,MAAAA,KAAK,EAAEO,KAAK,CAACP,KADR;AAELG,MAAAA,eAAe,EAAEI,KAAK,CAACJ,eAFlB;AAGLC,MAAAA,IAAI,EAAEG,KAAK,CAACH,IAHP;AAILC,MAAAA,SAAS,EAAEE,KAAK,CAACF,SAJZ;AAKLC,MAAAA,WAAW,EAAEC,KAAK,CAACD,WALd;AAMLe,MAAAA,SANK;AAOLG,MAAAA,YAPK;AAQLC,MAAAA,UARK;AASLG,MAAAA,kBATK;AAULC,MAAAA,UAVK;AAWLG,MAAAA,UAXK;AAYLC,MAAAA;AAZK,KADP;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KAeGnC,KAAK,CAACoC,QAfT,CADF;AAmBD,CAzID;;AA2IA,eAAerC,SAAf","sourcesContent":["import React, { useReducer } from 'react';\nimport axios from 'axios';\nimport AuthContext from './authContext';\nimport AuthReducer from './authReducer';\nimport setAuthToken from '../../utils/setAuthToken';\nimport {\n  REGISTER_SUCCESS,\n  REGISTER_FAIL,\n  USER_LOADED,\n  AUTH_ERROR,\n  LOGIN_SUCCESS,\n  LOGIN_FAIL,\n  LOGOUT,\n  UPDATE_SUCCESS,\n  UPDATE_FAIL,\n  PASSWORD_SUCCESS,\n  PASSWORD_FAIL,\n  USER_DELETED_SUCCESS,\n  USER_DELETED_FAIL,\n  SET_AUTH_LOADING,\n  CLEAR_AUTH_ERRORS\n} from '../types';\n\nconst AuthState = props => {\n  const initialState = { \n    token: localStorage.getItem('token'),\n    isAuthenticated: false,\n    user: null,\n    userError: null,\n    userLoading: false\n  };\n\n  const [state, dispatch] = useReducer(AuthReducer, initialState);\n\n  //used for requests sending data\n  const config = { \n    headers: { \n      'Content-Type': 'application/json'\n    }\n  };\n\n  //get user data\n  const getUser = async () => {\n    //console.log('getUser')\n    if (localStorage.token) {\n      setAuthToken(localStorage.token);\n    }\n    try {\n      setLoading();\n      const res = await axios.get('/api/auth');\n      dispatch({ type: USER_LOADED, payload: res.data })\n    } catch (err) {\n      dispatch({ type: AUTH_ERROR, payload: err.response.data.msg });\n    }\n  };\n\n  //log in user\n  const loginUser = async formData => {\n    //console.log('loginUser')\n    try {\n      setLoading();\n      const res = await axios.post('/api/auth', formData, config);\n      dispatch({ type: LOGIN_SUCCESS, payload: res.data });\n      getUser();\n    } catch (err) {\n      dispatch({ type: LOGIN_FAIL, payload: err.response.data.msg });\n    }\n  };\n\n  //register new user\n  const registerUser = async formData => {\n    //console.log('registerUser')\n    try {\n      setLoading();\n      const res = await axios.post('/api/users', formData, config);\n      dispatch({ type: REGISTER_SUCCESS, payload: res.data });\n      getUser();\n    } catch (err) {\n      dispatch({ type: REGISTER_FAIL, payload: err.response.data.msg });\n    }\n  };\n  \n  //update user\n  const updateUser = async user => {\n    //console.log('updateUser')\n    try {\n      setLoading();\n      const res = await axios.patch(`/api/auth/${user._id}`, user, config);\n      dispatch({ type: UPDATE_SUCCESS, payload: { user: res.data.user, msg: res.data.msg }});\n    } catch (err) {\n      dispatch({ type: UPDATE_FAIL, payload: err.response.data.msg });\n    }\n  };\n\n  //change user password\n  const changeUserPassword = async (formData, _id) => {\n    //console.log('changeUserPassword')\n    try { \n      setLoading();\n      const res = await axios.patch(`/api/auth/password/${_id}`, formData, config);\n      dispatch({ type: PASSWORD_SUCCESS, payload: res.data.msg });\n    } catch (err) {\n      dispatch({ type: PASSWORD_FAIL, payload: err.response.data.msg });\n    }\n  };\n\n  //delete user\n  const deleteUser = async (password, _id) => {\n    //console.log('deleteUser')\n    try {\n      setLoading();\n      const res = await axios.delete(`/api/auth/${_id}`, {\n        config,\n        data: {\n          password\n        }\n      });\n      dispatch({ type: USER_DELETED_SUCCESS, payload: res.data.msg });\n    } catch (err) {\n      dispatch({ type: USER_DELETED_FAIL, payload: err.response.data.msg });\n    }\n  };\n\n  //logout\n  const logoutUser = () => {\n    //console.log('logoutUser')\n    dispatch({ type: LOGOUT });\n  };\n\n  //set loading\n  const setLoading = () => {\n    //console.log('setLoading')\n    dispatch({ type: SET_AUTH_LOADING });\n  };\n\n  //clear errors\n  const clearUserErrors = () => {\n    //console.log('clearUserErrors')\n    dispatch({ type: CLEAR_AUTH_ERRORS });\n  };\n\n  return (\n    <AuthContext.Provider\n    value={{\n      token: state.token,\n      isAuthenticated: state.isAuthenticated,\n      user: state.user,\n      userError: state.userError,\n      userLoading: state.userLoading,\n      loginUser,\n      registerUser,\n      updateUser,\n      changeUserPassword,\n      deleteUser,\n      logoutUser,\n      clearUserErrors\n    }}>\n      {props.children}\n    </AuthContext.Provider>\n  )\n}\n\nexport default AuthState;"]},"metadata":{},"sourceType":"module"}